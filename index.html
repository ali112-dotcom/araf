<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K0DFPKH2NM"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-K0DFPKH2NM');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Official Student Admission Portal</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tiro+Bangla&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link rel="stylesheet" href="pagestyle.css">
    </head>
<body>

    <header>
        <div class="head-container">
            <img src="https://alarafmission.org/assets/images/logo.png" alt="Al-A'raf Mission Logo" class="logo-image">
            <div class="portal-title">
                Smart Mission Official Student registration Portal
            </div>
        </div>
    </header>

    <div id="printLayout">
        <div class="print-header">
            
            <div style="position: absolute; right: 0; top: 5px; border: 1px solid #000; width: 100px; height: 120px; display: flex; justify-content: center; align-items: center;">
                <img id="pr_photo" src="" alt="Photo" style="max-width: 100%; max-height: 100%; display: none;">
                <span id="pr_photo_placeholder" style="font-size: 10px; text-align: center;">Photo</span>
            </div>
        </div>
    </div>

    <main>
        <section id="home" class="hero">
            <div class="hero-content">
                <h1>AL-A'RAF MISSION</h1>
                <p>An ideal residential institution for talented students to achieve their dreams.</p>
                <a href="#admissionForm" class="btn-primary">Smart Mission</a>
            </div>
        </section>
    </main>

    <div id="loadingOverlay">
        <div class="spinner"></div>
        <p>Submitting Application...</p>
        <p>Please wait, do not close the window.</p>
    </div>

    <div class="container">
        
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="step-indicator">
            Step <span id="stepCount">1</span> of 3: <span id="stepTitle">Personal Details</span>
        </div>

        <form id="admissionForm">

            <div class="form-step active" id="step1">
                <h3>Personal Information</h3>
                
                <label>Student's Name <span class="bengali">ছাত্র/ছাত্রীর নাম</span></label>
                <input type="text" name="student_name" id="p_name" required oninput="validateStep()">

                <label>Student Photo <span class="bengali">ছাত্র/ছাত্রীর ছবি</span></label>
                <input type="file" id="fileInput" accept="image/*" onchange="handleFileSelect()" required>
                <small style="color: red;">Max size: 2MB</small>

                <input type="hidden" name="photoData" id="hidden_data">
                <input type="hidden" name="photoName" id="hidden_name">
                <input type="hidden" name="photoMimeType" id="hidden_mimetype">
                

                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label>Gender <span class="bengali">লিঙ্গ</span></label>
                        <select name="gender" id="p_gender" required oninput="validateStep()">
                            <option value="">Select</option>
                            <option>Male</option>
                            <option>Female</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label>Blood Group <span class="bengali">রক্তের গ্রুপ</span></label>
                        <select name="blood_group" id="p_bg" required oninput="validateStep()">
                            <option value="">Select</option>
                            <option>A+</option>
                            <option>A-</option>
                            <option>B+</option>
                            <option>B-</option>
                            <option>AB+</option>
                            <option>AB-</option>
                            <option>O+</option>
                            <option>O-</option>
                        </select>
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label>Date of Birth <span class="bengali">জন্ম তারিখ</span></label>
                        <input type="date" name="dob" id="p_dob" required oninput="validateStep()">
                    </div>
                    <div style="flex: 1;">
                        <label>Class <span class="bengali">শ্রেণি</span></label>
                        <select name="select_class" id="p_class" required oninput="validateStep()">
                            <option value="">Select</option>
                            <option>V</option>
                            <option>VI</option>
                            <option>VII</option>
                            <option>VIII</option>
                            <option>IX</option>
                        </select>
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label>Admission Date <span class="bengali">ভর্তির তারিখ</span></label>
                        <select name="admission_date" id="p_admDate" required oninput="validateStep()">
                        <option value="">-- Select Session --</option>
                        <option value="01/01/2025">2025-2026 session</option>
                        <option value="01/01/2026">2026-2027 session</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label>Aadhaar Number <span class="bengali">আধার নম্বর</span></label>
                        <input type="text" name="aadhaar_number" id="p_aadhaar" pattern="[0-9]{12}" maxlength="12" placeholder="12 Digit Aadhaar No" required oninput="validateStep()">
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label>Religion <span class="bengali">ধর্ম</span></label>
                        <input type="text" name="religion" id="p_rel" value="Muslim" required oninput="validateStep()">
                    </div>
                    <div style="flex: 1;">
                        <label>Mother Tongue <span class="bengali">মাতৃভাষা</span></label>
                        <input type="text" name="mother_tongue" id="p_mt" value="Bengali" required oninput="validateStep()">
                    </div>
                </div>

                <label>Student Contact No <span class="bengali">যোগাযোগ নম্বর</span></label>
                <input type="tel" name="phone" id="p_phone" pattern="[0-9]{10}" placeholder="10 Digit Mobile Number" required oninput="validateStep()">

                <label>Email ID <span class="bengali">ইমেইল আইডি</span></label>
                <input type="email" name="email" id="p_email" required oninput="validateStep()">

                <div class="btn-group" style="justify-content: flex-end;">
                    <button type="button" class="btn-next" id="nextBtn1" onclick="nextStep()" disabled>Next &rarr;</button>
                </div>
            </div>
            
            <div class="form-step" id="step2">
                <h3>Parent's Details</h3>

                <div style="background: #f9f9f9; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="margin:0; color: var(--primary-color);">Father's Info</h4>

                    <label>Father's Name <span class="bengali">পিতার নাম</span></label>
                    <input type="text" name="father_name" id="p_fname" required oninput="validateStep()">
                    
                    <label>Qualification <span class="bengali">পিতার শিক্ষাগত যোগ্যতা</span></label>
                    <input type="text" name="father_qualification" id="p_fquali" required oninput="validateStep()">
                   
                   <div style="display: flex; gap: 10px;">
                        <div style="flex:1">
                            <label>Occupation <span class="bengali">পেশা</span></label>
                            <input list="occupation_list" name="father_occupation" id="p_focc" required oninput="validateStep()">
                            <datalist id="occupation_list">
                                <option value="Farmer">
                                <option value="Businessman">
                                <option value="Teacher">
                                <option value="Driver">
                                <option value="Laborer">
                                <option value="Government Employee">
                                <option value="Private Sector Employee">
                                <option value="Self-Employed">
                                <option value="Unemployed">
                            </datalist>
                        </div>

                        <div style="flex:1">
                            <label>Income <span class="bengali">আয়</span></label>
                            <input type="number" name="father_income" id="p_fincome" placeholder="monthly income" required oninput="validateStep()">
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <div style="flex:1">
                            <label>Phone<span class="bengali">পিতার ফোন</span></label>
                            <input type="tel" name="father_contact" id="p_fcontact" pattern="[0-9]{10}" required oninput="validateStep()">
                        </div>
                        <div style="flex:1">
                            <label>WhatsApp no<span class="bengali">ওয়াটসঅ্যাপ নম্বর</span></label>
                            <input type="tel" name="father_whatsapp" id="p_fwhatsapp" pattern="[0-9]{10}" required oninput="validateStep()">   
                        </div>
                    </div>
                </div>

                <div style="background: #f9f9f9; padding: 10px; border-radius: 8px;">
                    <h4 style="margin:0; color: var(--primary-color);">Mother's Info</h4>
                    <label>Mother's Name <span class="bengali">মাতার নাম</span></label>
                    <input type="text" name="mother_name" id="p_mname" required oninput="validateStep()">
                    
                    <div style="display: flex; gap: 10px;">
                        <div style="flex:1">
                             <label>Qualification <span class="bengali">শিক্ষাগত যোগ্যতা</span></label>
                            <input type="text" name="mother_qualification" required oninput="validateStep()">
                        </div>
                        <div style="flex:1">
                            <label>Occupation <span class="bengali">পেশা</span></label>
                            <input type="text" name="mother_occupation" required oninput="validateStep()">
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <div style="flex:1">
                            <label>Income <span class="bengali">আয়</span> </label>
                            <input type="number" name="mother_income" placeholder="monthly income" required oninput="validateStep()">
                        </div>

                        <div style="flex:1">
                            <label>Phone <span class="bengali">মাতার ফোন</span></label>
                            <input type="tel" name="mother_contact" pattern="[0-9]{10}" required oninput="validateStep()">
                            <input type="hidden" name="mother_whatsapp" value="Same">
                        </div>
                    </div>

                    <div class="btn-group">
                        <button type="button" class="btn-prev" onclick="prevStep()">&larr; Back</button>
                        <button type="button" class="btn-next" id="nextBtn2" onclick="nextStep()" disabled>Next &rarr;</button>
                    </div>
                </div>
            </div>

            <div class="form-step" id="step3">
                <h3>Address Details</h3>
                
                <label>Village <span class="bengali">গ্রাম</span></label>
                <input type="text" name="student_Village" id="p_vill" required oninput="validateStep()">

                <div style="display: flex; gap: 10px;">
                    <div style="flex:1">
                        <label>Post Office <span class="bengali">পোস্ট অফিস</span></label>
                        <input type="text" name="student_PostOffice" id="p_po" required oninput="validateStep()">
                    </div>
                    <div style="flex:1">
                         <label>Police Station <span class="bengali">থানা</span></label>
                        <input type="text" name="student_Police_Station" id="p_ps" required oninput="validateStep()">
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                     <div style="flex:1">
                        <label>District <span class="bengali">জেলা</span></label>
                        <input type="text" name="student_district" id="p_dist" required oninput="validateStep()">
                    </div>
                    <div style="flex:1">
                        <label>State <span class="bengali">রাজ্য</span></label>
                        <input type="text" name="student_state" id="p_state" required oninput="validateStep()">
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                     <div style="flex:1">
                        <label>Pin Code <span class="bengali">পিন কোড</span></label>
                        <input type="text" name="zip" id="p_pin" pattern="[0-9]{6}" required oninput="validateStep()">
                    </div>
                     <div style="flex:1">
                        <label>Country<span class="bengali">দেশ</span></label>
                        <input type="text" name="student_country" value="India" readonly>
                    </div>
                </div>

                 <div class="btn-group">
                    <button type="button" class="btn-prev" onclick="prevStep()">&larr; Back</button>
                    <button type="submit" class="btn-submit" id="submitBtn" disabled>Submit Application</button>
                </div>
            </div>

        </form>
    </div>

    <div id="printLayout">
        <div class="print-header">
            <h1>AL-A'RAF MISSION</h1>
            <h2>Smart Mission Registration Form</h2>
            <p>Generated: <span id="print_timestamp"></span></p>
        </div>

        <h3>Student Profile</h3>
        <table class="print-table">
            <tr>
                <th>Name</th>
                <td><span id="pr_name"></span></td>
                <th>Gender</th>
                <td><span id="pr_gender"></span></td>
            </tr>
            <tr>
                <th>Date of Birth</th>
                <td><span id="pr_dob"></span></td>
                <th>Blood Group</th>
                <td><span id="pr_bg"></span></td>
            </tr>
            <tr>
                <th>Class Applied</th>
                <td><span id="pr_class"></span></td>
                <th>Aadhaar No</th> <td><span id="pr_aadhaar"></span></td>
            </tr>
            <tr>
                <th>Religion</th>
                <td><span id="pr_rel"></span></td>
                <th>Mobile</th>
                <td><span id="pr_phone"></span></td>
            </tr>
            <tr>
                <th>Email</th>
                <td colspan="3"><span id="pr_email"></span></td>
            </tr>
        </table>

        <h3>Parent Information</h3>
        <table class="print-table">
            <tr>
                <th>Father's Name</th>
                <td><span id="pr_fname"></span></td>
                <th>Contact</th>
                <td><span id="pr_fcontact"></span></td>
            </tr>
            <tr>
                <th>Qualification</th>
                <td><span id="pr_fquali"></span></td>
                <th>Occupation</th>
                <td><span id="pr_focc"></span></td>
            </tr>
            <tr>
                <th>Income</th>
                <td><span id="pr_fincome"></span></td>
                <th>Mother's Name</th>
                <td><span id="pr_mname"></span></td>
            </tr>
        </table>

        <h3>Residential Address</h3>
        <table class="print-table">
            <tr>
                <th>Village</th>
                <td><span id="pr_vill"></span></td>
                <th>PO</th>
                <td><span id="pr_po"></span></td>
            </tr>
            <tr>
                <th>PS</th>
                <td><span id="pr_ps"></span></td>
                <th>Dist/State</th>
                <td><span id="pr_dist"></span>, <span id="pr_state"></span></td>
            </tr>
            <tr>
                <th>Pin Code</th>
                <td><span id="pr_pin"></span></td>
                <th>Country</th>
                <td>India</td>
            </tr>
        </table>

        <div class="print-footer">
            <div>
                <br>_______________________<br>
                Guardian Signature
            </div>
            <div>
                <br>_______________________<br>
                Office Seal & Signature
            </div>
        </div>
    </div>


    <script>
        let currentStep = 0;
        const steps = document.querySelectorAll(".form-step");
        const progressBar = document.getElementById("progressBar");
        const stepCountSpan = document.getElementById("stepCount");
        const stepTitleSpan = document.getElementById("stepTitle");
        const stepTitles = ["Personal Details", "Parent Information", "Address Information"];

        // Initialize
        updateUI();

        function updateUI() {
            // Show current step, hide others
            steps.forEach((step, index) => {
                step.classList.toggle("active", index === currentStep);
            });

            // Update Progress Bar
            const progress = ((currentStep + 1) / steps.length) * 100;
            progressBar.style.width = `${progress}%`;

            // Update Text
            stepCountSpan.innerText = currentStep + 1;
            stepTitleSpan.innerText = stepTitles[currentStep];

            validateStep(); // Check if current step is valid on load
        }

        function nextStep() {
            if (currentStep < steps.length - 1) {
                currentStep++;
                updateUI();
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                updateUI();
            }
        }

        // Real-time Validation Function
        function validateStep() {
            const currentStepDiv = steps[currentStep];
            const inputs = currentStepDiv.querySelectorAll("input, select");
            let isValid = true;

            inputs.forEach(input => {
                if (!input.checkValidity()) {
                    isValid = false;
                }
            });

            // Find the button in this step
            if(currentStep === 0) {
                document.getElementById("nextBtn1").disabled = !isValid;
            } else if(currentStep === 1) {
                document.getElementById("nextBtn2").disabled = !isValid;
            } else if(currentStep === 2) {
                document.getElementById("submitBtn").disabled = !isValid;
            }
        }

        // Handle File Selection & Conversion
function handleFileSelect() {
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];
    
    if (file) {
        // Limit size to 2MB (Google Apps Script limit safety)
        if (file.size > 2 * 1024 * 1024) {
            alert("File is too big! Please select an image under 2MB.");
            fileInput.value = ""; // Reset
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            const base64String = e.target.result;
            
            // 1. Store in hidden inputs for submission
            document.getElementById('hidden_data').value = base64String;
            document.getElementById('hidden_name').value = file.name;
            document.getElementById('hidden_mimetype').value = file.type;

            // 2. Show Preview in Print Layout immediately
            const printImg = document.getElementById('pr_photo');
            const printPlaceholder = document.getElementById('pr_photo_placeholder');
            
            printImg.src = base64String;
            printImg.style.display = "block";
            printPlaceholder.style.display = "none";
        };
        reader.readAsDataURL(file);
    }
}

        // Map Input Values to Print Layout
        function fillPrintValues() {
            // Set Timestamp
            document.getElementById("print_timestamp").innerText = new Date().toLocaleString();

            // Map IDs from Input -> Print Span
            const map = {
                // Student Details
                "p_name": "pr_name", 
                "p_gender": "pr_gender",
                "p_dob": "pr_dob",
                "p_bg": "pr_bg", 
                "p_class": "pr_class",
                "p_aadhaar": "pr_aadhaar", // <--- ADD THIS LINE 
                "p_rel": "pr_rel",
                "p_phone": "pr_phone", 
                "p_email": "pr_email", 
                
                // Parent Details (Fixed the missing fields)
                "p_fname": "pr_fname",
                "p_fcontact": "pr_fcontact", 
                "p_fquali": "pr_fquali", 
                "p_focc": "pr_focc", 
                "p_fincome": "pr_fincome", 
                "p_mname": "pr_mname",
                
                // Address Details
                "p_vill": "pr_vill", 
                "p_po": "pr_po", 
                "p_ps": "pr_ps",
                "p_dist": "pr_dist", 
                "p_state": "pr_state", 
                "p_pin": "pr_pin"
            };

            for (let [inputId, printId] of Object.entries(map)) {
                let inputEl = document.getElementById(inputId);
                let printEl = document.getElementById(printId);

                if (inputEl && printEl) {
                    printEl.innerText = inputEl.value;
                }
            }
        }

        // Form Submission Logic
        document.getElementById("admissionForm").addEventListener("submit", function(e) {
            e.preventDefault();
            
            // Show Loading Overlay
            document.getElementById("loadingOverlay").style.display = "flex";

            const formData = new FormData(this);

            fetch("https://script.google.com/macros/s/AKfycbx1eHbUKcLRj1ok6ibz3t9AqhW0qYBCJ2JUfNkRrkdnXqaPcfJH_Pk7F65s1hGW5JhWKg/exec", {
                method: "POST",
                body: formData
            })
            .then(res => res.text())
            .then(msg => {
                // Hide Loader
                document.getElementById("loadingOverlay").style.display = "none";
                
                // Prepare Data for Print
                fillPrintValues();

                // Ask to Print
                if(confirm("Form Submitted Successfully! Do you want to download the Official Receipt?")) {
                    window.print();
                }

                // Reset Form and go back to step 1
                this.reset();
                currentStep = 0;
                updateUI();
            })
            .catch(err => {
                document.getElementById("loadingOverlay").style.display = "none";
                alert("Error submitting form. Please check your internet connection.");
            });
        });
    </script>

</body>
</html>
